<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RC Marketplace (Mobile)</title>
<style>
body{font-family:system-ui,Arial;background:#f3f4f6;margin:0;padding:10px}
.header{display:flex;justify-content:space-between;align-items:center}
.card{background:#fff;padding:12px;border-radius:8px;margin-bottom:10px;box-shadow:0 1px 2px rgba(0,0,0,0.05)}
.btn{background:#0ea5e9;color:white;padding:8px 10px;border-radius:6px;border:none}
.small{font-size:13px;color:#374151}
</style>
</head>
<body>
<div class="header"><h1>RC Marketplace</h1><div id="owner"></div></div>
<div id="content"></div>
<script>
const API = '';
async function loadInfo(){ const r=await fetch('/api/info'); const j=await r.json(); document.getElementById('owner').innerText = j.siteName + ' — Owners: ' + j.owners.map(o=>o.name).join(', '); }
async function loadItems(){ const r=await fetch('/api/items'); const items=await r.json(); const el=document.getElementById('content'); el.innerHTML=''; for(const it of items){ const card = document.createElement('div'); card.className='card'; card.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${it.title}</strong><div class="small">${it.category} • ${it.brand||''} ${it.model||''}</div></div><div><div style="font-weight:600">$${(it.price/100).toFixed(2)}</div><div class="small">Status: ${it.status}</div></div></div><div style="margin-top:8px" id="bb-${it.id}"></div>`; el.appendChild(card); checkBlueBook(it); if(it.status==='expired'){ const btn=document.createElement('button'); btn.className='btn'; btn.innerText='Renew Listing'; btn.onclick=()=>{ const p=prompt('Enter new price (USD) or leave blank'); const img=prompt('New image URL or blank'); const ship=prompt('Shipping cost (USD) or blank'); fetch(`/api/items/${it.id}/renew`,{method:'POST',headers:{'content-type':'application/json',authorization: localStorage.getItem('token')? 'Bearer '+localStorage.getItem('token'): ''}, body: JSON.stringify({ price: p? Math.round(Number(p)*100): undefined, imageUrl: img||undefined, shippingCost: ship? Math.round(Number(ship)*100): undefined })}).then(r=>r.json()).then(j=>{ alert('Renewed'); loadItems(); }).catch(e=>alert('Error')); }; card.appendChild(btn); } } }
async function checkBlueBook(item){ const r=await fetch(`/api/bluebook?brand=${encodeURIComponent(item.brand||'')}&model=${encodeURIComponent(item.model||'')}&category=${encodeURIComponent(item.category)}`); const entries=await r.json(); const el=document.getElementById('bb-'+item.id); if(entries.length===0){ el.innerText='No Blue Book data'; return; } const avg = Math.round(entries.reduce((s,e)=>s+e.basePriceCents,0)/entries.length); el.innerHTML = `<div class="small">BlueBook suggested: $${(avg/100).toFixed(2)} (range $${(Math.min(...entries.map(e=>e.minPriceCents))/100).toFixed(2)} - $${(Math.max(...entries.map(e=>e.maxPriceCents))/100).toFixed(2)})</div>`; if(item.price > avg){ const note=document.createElement('div'); note.className='small'; note.style.color='orange'; note.innerText='Your price is above Blue Book average — consider lowering for faster sale.'; el.appendChild(note); } }
window.onload = ()=>{ loadInfo(); loadItems(); }
</script>
</body>
</html>